## 十字绣图纸生成器 - 核心功能描述
### 功能概述
将用户上传的任意图片（JPG/PNG/GIF）自动转换为可用于十字绣的图纸，生成带符号、颜色标记的网格图案，并提供下载和打印功能。

### 核心算法流程 
1. 图片预处理
- 使用 Canvas API 加载用户上传的图片
- 支持图片压缩（通过 DKFileImageCompressor 类）
- 将图片绘制到 Canvas 上获取像素数据（ getImageData ） 
2. 颜色量化（关键步骤）
- 根据用户设置的最大颜色数量（例如 32/48/64/96/128 色）
- 使用 K-Means 或中位切分算法进行颜色量化
- 将图片中的所有像素映射到最接近的量化颜色
- 为每个量化颜色分配：
  - RGB 值
  - 符号（如 A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P 等）
  - DMC 线号（可选） 
3. 网格划分
- 用户可设置网格宽度（例如 50-150 格）
- 网格高度根据图片比例自动计算
- 每个网格单元对应一个十字绣的"针"
- 采样方式：取每个网格单元的中心点像素颜色 
4. 生成十字绣数据结构
```
{
  cells: [
    { color: {r,g,b, symbol}, x: 0, y: 0 },  // 每个针的位
    置和颜色
    // ...
  ],
  colors: [
    { r,g,b, symbol, name, count, hex },  // 所有使用的颜色
    及其使用次数
    // ...
  ],
  width: 80,   // 网格宽度
  height: 60  // 网格高度
}
``` 5. 渲染十字绣图案
- 使用 Canvas 绘制网格背景（灰色线条）
- 每个网格单元填充对应的量化颜色
- 在颜色较深的格子显示白色符号，浅色格子显示黑色符号
- 每个格子显示对应的十字绣符号字母 6. 颜色清单生成
- 列出所有使用的颜色
- 显示：色块、符号、颜色名称、RGB/HEX 值、使用次数（针数）、占比
- 计算总针数和预计用线长度（每针约 0.8 厘米） 7. 导出功能
- 下载图案 ：将 Canvas 导出为 PNG 图片
- 打印功能 ：生成包含图案和颜色清单的打印页面
### 用户可调参数
参数 说明 默认值 最大颜色数 颜色量化后的颜色数量 48 网格宽度 十字绣图案的横向格数 80 网格高度 十字绣图案的纵向格数 自动计算

### 技术实现要点
1. 前端 Canvas 处理 ：所有图像处理在浏览器端完成
2. 颜色量化算法 ：需要实现颜色聚类算法（K-Means 或中位切分）
3. 最近颜色匹配 ：欧几里得距离计算 RGB 颜色相似度
4. 对比度计算 ：根据亮度判断使用黑色还是白色文字符号
   ```
   brightness = (r * 299 + g * 587 + b * 114) / 1000
   contrastColor = brightness > 128 ? '#000000' : 
   '#ffffff'
   ```
### 给 AI 的简洁提示
如果你用全栈模板的 AI，可以这样告诉它：

请帮我实现一个十字绣图纸生成器，功能包括：

1. 用户上传图片，前端 Canvas 处理
2. 颜色量化：将图片颜色减少到 N 种（用户可设置 32-128 色）
3. 网格划分：将图片分为 M×N 网格，每个网格代表一个十字绣针
4. 为每个网格分配颜色和符号（A、B、C...）
5. 渲染带符号的十字绣图案（Canvas 绘制）
6. 生成颜色清单：显示每种颜色的色块、符号、针数、占比
7. 提供下载图案 PNG 和打印功能
技术栈：前端使用 Canvas API，颜色量化使用 K-Means 或中位切分算法## 十字绣图纸生成器 - 核心功能描述
### 功能概述
将用户上传的任意图片（JPG/PNG/GIF）自动转换为可用于十字绣的图纸，生成带符号、颜色标记的网格图案，并提供下载和打印功能。

### 核心算法流程 1. 图片预处理
- 使用 Canvas API 加载用户上传的图片
- 支持图片压缩（通过 DKFileImageCompressor 类）
- 将图片绘制到 Canvas 上获取像素数据（ getImageData ） 2. 颜色量化（关键步骤）
- 根据用户设置的最大颜色数量（例如 32/48/64/96/128 色）
- 使用 K-Means 或中位切分算法进行颜色量化
- 将图片中的所有像素映射到最接近的量化颜色
- 为每个量化颜色分配：
  - RGB 值
  - 符号（如 A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P 等）
  - DMC 线号（可选） 3. 网格划分
- 用户可设置网格宽度（例如 50-150 格）
- 网格高度根据图片比例自动计算
- 每个网格单元对应一个十字绣的"针"
- 采样方式：取每个网格单元的中心点像素颜色 4. 生成十字绣数据结构
```
{
  cells: [
    { color: {r,g,b, symbol}, x: 0, y: 0 },  // 每个针的位
    置和颜色
    // ...
  ],
  colors: [
    { r,g,b, symbol, name, count, hex },  // 所有使用的颜色
    及其使用次数
    // ...
  ],
  width: 80,   // 网格宽度
  height: 60  // 网格高度
}
``` 5. 渲染十字绣图案
- 使用 Canvas 绘制网格背景（灰色线条）
- 每个网格单元填充对应的量化颜色
- 在颜色较深的格子显示白色符号，浅色格子显示黑色符号
- 每个格子显示对应的十字绣符号字母 6. 颜色清单生成
- 列出所有使用的颜色
- 显示：色块、符号、颜色名称、RGB/HEX 值、使用次数（针数）、占比
- 计算总针数和预计用线长度（每针约 0.8 厘米） 7. 导出功能
- 下载图案 ：将 Canvas 导出为 PNG 图片
- 打印功能 ：生成包含图案和颜色清单的打印页面
### 用户可调参数
参数 说明 默认值 最大颜色数 颜色量化后的颜色数量 48 网格宽度 十字绣图案的横向格数 80 网格高度 十字绣图案的纵向格数 自动计算

### 技术实现要点
1. 前端 Canvas 处理 ：所有图像处理在浏览器端完成
2. 颜色量化算法 ：需要实现颜色聚类算法（K-Means 或中位切分）
3. 最近颜色匹配 ：欧几里得距离计算 RGB 颜色相似度
4. 对比度计算 ：根据亮度判断使用黑色还是白色文字符号
   ```
   brightness = (r * 299 + g * 587 + b * 114) / 1000
   contrastColor = brightness > 128 ? '#000000' : 
   '#ffffff'
   ```
### 给 AI 的简洁提示
如果你用全栈模板的 AI，可以这样告诉它：

请帮我实现一个十字绣图纸生成器，功能包括：

1. 用户上传图片，前端 Canvas 处理
2. 颜色量化：将图片颜色减少到 N 种（用户可设置 32-128 色）
3. 网格划分：将图片分为 M×N 网格，每个网格代表一个十字绣针
4. 为每个网格分配颜色和符号（A、B、C...）
5. 渲染带符号的十字绣图案（Canvas 绘制）
6. 生成颜色清单：显示每种颜色的色块、符号、针数、占比
7. 提供下载图案 PNG 和打印功能
技术栈：前端使用 Canvas API，颜色量化使用 K-Means 或中位切分算法